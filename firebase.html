<!doctype html>
<title>codin9cafe</title>
<meta charset="UTF-8" />
<link rel="stylesheet" href="firebase.css">


<script src="node_modules/mithril/mithril.min.js"></script>

<!-- firebase SDK from CDN -->
<script src="https://www.gstatic.com/firebasejs/3.4.1/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.4.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.4.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.4.0/firebase-database.js"></script>

<script src="mithrilfire.js"></script>
<script src="firebase.config.js"></script>

<body>
<script>
  var codin9cafe = {} || "";

  codin9cafe.vm = (function(){
    var vm = {};
    vm.init = function(){
      firebase.initializeApp(config);
    };

    return vm; 
  }())

  codin9cafe.controller = function(){
    codin9cafe.vm.init();
    return {
      events: function(){
        var ref = firebase.database().ref("events/");
        var events = m.firebase(ref.orderByChild("num"));
        return events.reverse();
      },
      presentations: function(id){
        var ref = firebase.database().ref("events/" + id + "/seminars/");
        var presentations = m.firebase(ref);
        return presentations;
      },
      timer: function(presentation){
        alert("타이머 시작");
      },
      like: function(presentation){
        alert("좋아요");
      }
    }
  }

  codin9cafe.view = function(ctrl){
    return [
      m('h1', 'Codin9cafe Events List'),
      m('ul', 
        ctrl.events().map(function(event){
          return [
            m('li', {id: event.$id, class: "event"}, event.date + ' / ' + event.num + ' / ' + event.loc),
            m('ul', 
              ctrl.presentations(event.$id).map(function(presentation){
                console.log(presentation)
              })
            )
          ]
        })
      )
    ];
  }

  m.module(document.body, codin9cafe);
</script>
</body>